<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../article.css"> 
    <title>オファーテキスト文体分類</title>
</head>
<body>
    <h1>オファーテキスト文体分類</h1>
		<div class="authors">
			<div class="author">
				<p class="name">たんかるP</p>
				<p class="email">tankarup@gmail.com</p>
			</div>
		</div>
		<ul class="tableOfContents">目次</ul>
		<h2>はじめに</h2>
		<p>ミリシタには「オファー」という機能があります。「オファー」には、765プロがオファーをうけた仕事に参加したアイドルから別のアイドルに向けた台詞が収録されています。ミリシタでは52人のアイドルが登場するので、52人の組み合わせ、つまり52*51=2652組のオファーテキストが準備されています。さらに、個人のオファーテキストが3種類あったり、組み合わせオファーが2週目に入っていたりと、その数は増え続けています。</p>
		<figure id="offer_sample">
			<img src="sample.jpg" width="400">
			<figcaption>育からエミリーへの「オファーテキスト」</figcaption>
		</figure>
		<p>このオファーテキストは、誰から誰に向けた台詞なのかがはっきりしており、また分量が均等であるため、テキスト分析に非常に向いています。</p>
		<p>ということで分析してみましょう。</p>
		<p>実は以前にもオファーテキスト分析を実施したことがあります<a href="#ref_offer_text"></a>。この時は、使用している単語に注目して、テキストマイニングを実施しました。</p>
		<p>今回は文体に注目してみます。</p>

		<h2>使用語ランキング</h2>
		<p>オファーテキストから「っ！？、。～…☆♪ぁー」の数をカウントし、ランキングを作りました。</p>
		<p>使用したオファーテキストは、グリマス日和さんが集めているテキスト<a href="#ref_greemas"></a>を転用しました。分析個数は2661個で、一人当たり平均51個です。</p>

		<p>分析結果を以下に示します。例えば<a href="#っ"></a>を見ると、昴はオファーテキストで「っ」を多用しており、1回のオファーで平均3.9回「っ」を使っています。一方で貴音は「っ」の使用頻度が低く、1回のオファーで使っている「っ」の数は平均0.8回です。約5倍の差があります。当然ではありますが、アイドルによって言葉の遣い方がかなり違っていて特徴が顕れていることが分かります。</p>
		<p>では「っ！？、。～…☆♪ぁ」で調べた結果を見てみましょう。自分でやってみたい人はスプレッドシートを公開<a href="#ref_offer_analysis"></a>しているので、気になる単語で試してみてください。</p>

		<div id="figures"></div>
		<div style="clear:left;"></div>


		<h2>アイドル分類</h2>
		<p>オファーテキストで各アイドルがどの文字を多用しているのかが分かりました。では、文字の使い方、つまり文体が似ているアイドルを探してみましょう。</p>
		<p>上記のグラフは1オファーあたりのテキスト数をカウントしていますが、このデータを100文字あたりのテキスト数に換算し、主成分分析にかけて文字を使う傾向を二次元プロットしました。使ったデータの<a href="data.csv">CSVファイル</a>も置いときます。</p>
		<p>ざっくり分類すると、
		<ul>
			<li>右側に、記号をあまり使わない「クール」系</li>
			<li>左上が、！？☆っを使う「元気」系</li>
			<li>下側が、♪～を使う「楽しい」系</li>
			<li>右上が、、…ぁを使う「おとなしい」系</li>
		</ul>
		って感じでしょうか。</p>
		<p>近くに配置されたアイドルの言葉遣いが似てるってことだと思いますが、気になったところをいくつか挙げます。
			<ul>
				<li>瑞希×志保：クール系美少女ユニットの貫禄です。紬はまだクールになりきれていないようです。</li>
				<li>歌織×エミリー：落ち着いた、いいところのお嬢さんの話し方なんでしょうね。おや、近くに千鶴さんがいますね。</li>
				<li>亜利沙×育：テキストの内容はともかくとして文体は似てるようです。個人的にもメールをやりとりしているようですし…(2022/5/24メール)</li>
			</ul>
		</p>

		<figure id="biplot">
			<img src="biplot.jpg" width="800">
			<figcaption>使用頻度が高い文字で主成分分析し、第1・第2主成分でプロット</figcaption>
		</figure>

		<h2>あなたは誰に似ている？</h2>
		<p>せっかくなので、あなたの「オファーテキスト」をテキストボックスに入力してください。あなたと似ているアイドルを調べます。各文字の二乗和を取って判定しただけなのでかなり適当です<span class="note">(スコア=Σ(あなたの文字使用頻度-アイドルの文字使用頻度)<sup>2</sup>で計算。各文字の独立性とか考慮すべきなんでしょうが…)</span>。ちゃんと判定したい人は「ミリオンライブ！台詞判定」<a href="#ref_hantei"></a>をどうぞ。</p>
		<div style="margin:auto; width: 50%;">
			<textarea id="your_text" style="width: 80%; height: 100px;"></textarea>
			<button onclick="find_simillar_idol();">調べる</button>
			<table id="results_table" style="display: none;">
			<tr>
				<td style="border-style:none;"><div id="score_results"></div></td>
				<td style="border-style:none; vertical-align:top;"><div id="idols_option"></div><div id="change_style"></div></td>
			</tr>

			</table>
		</div>
		<h2>参考文献</h2>
			<ul class="biblio">
				<li id="ref_greemas">グリマス日和、<a href="https://greemas.doorblog.jp/archives/cat_1329442.html">オファー</a></li>
				<li id="ref_offer_text">たんかる、<a href="https://tankarup.github.io/MillionLive-analysis/texts/offer_text_analysis/offer_text_analysis.html">オファーテキスト分析によるアイドルのグループ化の試み</a></li>
				<li id="ref_offer_analysis">たんかる、<a href="https://docs.google.com/spreadsheets/d/1gtJPvCjfQmQgWI43w38QvVoml8OUCK0lHSJjdDh9lm8/edit#gid=1389740003">オファーテキスト簡易分析</a></li>
				<li id="ref_hantei">たくみ、<a href="https://www.shuukei.info/imas_ml_words/#/">ミリオンライブ！台詞判定</a></li>
			</ul>
			<p>本資料では、アイドルマスターミリオンライブシアターデイズのオファーテキストを分析に使用しています。オファーテキストの著作権はBNEI社にあります。</p>
		


    <script src="../article.js"></script>
	<script>
function init(){
	add_figures();
	init_options();
}
function init_options(){
	let select_html = '';
	let options_html = '';
	for (const idol in style){
		options_html += `<option value="${idol}">${idol}</option>`;
	}
	select_html += `あなたのテキストを<select name="idol" id="idol" onchange="show_style_change();">${options_html}</select>風に近づけるには…`;
	document.getElementById('idols_option').innerHTML = select_html;
}

function get_score_html(){

}

//{'…': 1.2, '、': 0.2, ...} 100字あたりカウント
function get_your_style(){
	const text = document.getElementById('your_text').value;
	const text_length = text.length;
	let words_values = {}; 
	for (const word of words){
		words_values[word] = str_count(text, word)/text_length*100;
	}
	return words_values;
}
function set_idol(idol){
	document.getElementById('idol').value = idol;
}
function age_sage(your_value, idol_value){
	if (!Number.isFinite(your_value)) return 'が何か変です……'
	if (your_value/idol_value > 1.2) return 'の使用率を下げましょう。';
	if (your_value/idol_value < 0.8) return 'の使用率を上げましょう。';
	return 'の使用率はばっちりです。'
}
function show_style_change(){
	const idol = document.getElementById('idol').value;
	const idol_style = style[idol];
	const your_style = get_your_style();
	let html ='';
	for (const word of words){
		html += `<li>「${word}」${age_sage(your_style[word], idol_style[word])}</li>`;
	}
	document.getElementById('change_style').innerHTML = `<ul>${html}</ul>`;

}
function find_simillar_idol(){

	let distances = []; //[{name:'春香', distance:10}, ...]
	const words_values = get_your_style();
	for (const idol in style){
		let distance = 0;
		for (const word of words){
			distance += (style[idol][word] - words_values[word])**2;
		}
		distances.push({
			name: idol,
			distance: distance,
		});
	}
	distances.sort(function(a,b){
        if( a.distance < b.distance ) return -1;
        if( a.distance > b.distance ) return 1;
        return 0;
	});
	let score_html = '';
	score_html += `<p>判定結果：<strong>あなたは${distances[0].name}さんに似ている</strong>気がします。</p>`;
	score_html += '<table ><thead><tr><th>アイドル</th><th>スコア</th></tr></thead><tbody>';
	for (let idol of distances){
		score_html += `<tr><td>${idol.name}</td><td>${idol.distance.toFixed(1)}</td></tr>`;
	}
	score_html += '</tbody></table>';
	document.getElementById('score_results').innerHTML = score_html;

	const display = document.getElementById('results_table').style.display;
	if (document.getElementById('results_table').style.display == 'none') {
		document.getElementById('results_table').style.display = 'block';
		set_idol(distances[0].name);
	}
	
	show_style_change();
	
	

}
function str_count(all, part) {
    return (all.match(new RegExp(part, "g")) || []).length;
}

const figure_texts =`
っ	元気系アイドルが多用してるねっ。
！	こっちも元気系アイドルが多用してましたよ！
？	美希と亜美があたまひとつ抜けてますが、全体的な傾向がよくわかりませんね？　元気系もクール系もいろんな遣い方がある感じ？
、	可憐が、とびぬけて多いですが、他のアイドルは、平均的に使ってました
ー	カタカナを使うロコがナンバーワンです。エミリーはカタカナを使わないというのもありますが、そもそも長音を使ってません。
♪	可奈が話す言葉は～♪ 全部音楽になるそのまま～♪
～	ゆっくり話すアイドルがたくさん使っていますね～　可奈やあずささんは♪との組み合わせで多くなってます～　麗花さんは長音に「ー」を使うので少ないです～
…	とぎれとぎれ話す……アイドルだね……。
☆	海美は美希の女子力を参考にしてるのかもね☆
ぁ	ひなたの語尾はねぇ、なまら優しいんだぁ。
。	！や？を使わないアイドルが上位に来ています。クール系。美奈子の使用が少ないのがちょっと意外でした。語尾にいろんな記号を多用しているので、他の記号ランキングでは上位に顕れなかったようです。
`;
function add_figures(){
	const lines = figure_texts.split('\n');

	let html = '';
	for (const line of lines){
		const items = line.split('\t');
		if (items.length < 2) continue;
		html += `
		<figure id="${items[0]}" style="">
			<img src="${items[0]}.jpg" width="500">
			<figcaption>1オファーあたりの「${items[0]}」使用数　<br>${items[1]}</figcaption>
		</figure>
		`;
	}
	document.getElementById('figures').innerHTML = html;
}



const data = `name	…	、	。	！	？	☆	♪	～	っ	ぁ	ー
春香	1.222493888	3.300733496	1.882640587	1.320293399	0.2200489	0	0.733496333	0.171149144	3.643031785	0.2200489	1.002444988
千早	1.761349541	3.547506822	3.994046142	0.09923096	0.04961548	0	0.02480774	0	2.034234681	0.04961548	0.868270901
美希	0.501672241	3.595317726	2.926421405	0.557413601	0.836120401	0.445930881	0.22296544	0.05574136	5.797101449	0	1.059085842
雪歩	3.09402949	3.867536862	2.538071066	0.749335267	0.265893159	0	0.459270002	0.169204738	3.190717912	0.507614213	0.797679478
やよい	0.415749572	4.133039863	0.978234287	2.494497432	0.097823429	0	0.366837858	0.146735143	4.76889215	0.024455857	2.176571289
真	1.72993753	3.315713599	1.68188371	1.922152811	0.312349832	0	0.312349832	0.192215281	3.604036521	0.192215281	1.201345507
伊織	1.21045392	3.356258597	2.778541953	0.770288858	0.330123796	0	0.385144429	0.027510316	3.906464924	0.027510316	1.21045392
貴音	1.69225948	3.79191476	3.509871514	0.031338139	0.407395801	0	0	0	1.316201818	0	1.065496709
律子	1.517927244	3.323737242	2.826485213	0.758963622	0.130855797	0	0.183198116	0.026171159	3.062025648	0	1.020675216
あずさ	0.830737279	3.426791277	2.777777778	0.10384216	0.10384216	0	1.038421599	1.479750779	2.751817238	0	0.59709242
亜美	1.016349978	3.424657534	1.082633672	2.165267344	0.751215201	0	0.397702165	0.83959346	4.396818383	0.022094565	2.032699956
真美	0.578034682	3.678402522	1.392538098	1.944298476	0.551760378	0	0.525486075	0.788229112	4.939569101	0.026274304	1.76037835
響	0.882167612	3.969754253	1.291745432	2.520478891	0.283553875	0	0.094517958	0.126023945	4.725897921	0	2.142407057
未来	1.073883162	3.586769759	1.33161512	1.439003436	0.300687285	0	0.902061856	0.257731959	4.059278351	0.021477663	1.116838488
静香	2.737306843	3.509933775	3.024282561	0.6401766	0.176600442	0	0.022075055	0.022075055	2.649006623	0.04415011	0.55187638
翼	0.724112962	3.21023413	1.375814627	1.448225923	0.410330678	0	0.94134685	1.32754043	4.103306783	0.096548395	1.351677528
琴葉	2.153040442	3.40413151	3.025894676	0.610997963	0.174570847	0	0.232761129	0.058190282	2.793133547	0.116380564	0.756473669
エレナ	0.340618791	3.491342606	1.561169458	1.759863752	0.312233892	0	0.879931876	0.36900369	4.910587567	0	1.816633551
美奈子	0.913621263	3.239202658	0.996677741	2.200996678	0.166112957	0	0.830564784	0.53986711	3.696013289	0	1.121262458
恵美	0.502232143	3.348214286	2.008928571	1.450892857	0.362723214	0	0.892857143	0.502232143	5.022321429	0.027901786	1.255580357
まつり	0.757744596	2.874972142	2.83039893	1.181190105	0.356585692	0	0.245152663	0.066859817	2.652106084	0.022286606	1.604635614
星梨花	1.018375028	3.232233783	1.593978304	1.306176666	0.265663051	0	0.619880452	0.066415763	2.833739207	0	0.951959265
茜	1.488691669	3.235041512	1.288290867	1.918121958	0.572573719	0	0.372172917	0.543945033	3.320927569	0.028628686	1.545949041
杏奈	10.1539742	5.617977528	3.03786933	0.624219725	0.083229297	0	0.49937578	0	4.119850187	0.041614648	0.998751561
ロコ	1.02319236	2.5579809	0.954979536	2.251023192	0.102319236	0	0.068212824	0.068212824	1.53478854	0	3.206002729
百合子	2.417582418	3.252747253	1.626373626	1.604395604	0.241758242	0	0.373626374	0.021978022	3.142857143	0.10989011	0.879120879
紗代子	1.153262519	3.520485584	1.760242792	1.851289833	0.121396055	0	0.182094082	0	2.943854325	0.091047041	0.758725341
亜利沙	2.173913043	3.743961353	0.815217391	3.019323671	0.301932367	0	0.332125604	0.362318841	2.747584541	0.030193237	0.754830918
海美	0.193298969	3.286082474	0.644329897	3.06056701	0.386597938	0.354381443	0.386597938	0.547680412	5.863402062	0	1.836340206
育	0.442641092	3.799336038	1.586130579	2.139431944	0.184433788	0	0.442641092	0.184433788	4.684618222	0.073773515	1.069715972
朋花	0.248678893	3.543674231	2.890892136	0.031084862	0	0	0.74603668	2.890892136	1.740752254	0	0.652782095
エミリー	1.524926686	3.225806452	2.023460411	1.319648094	0.146627566	0	0.64516129	0.029325513	1.495601173	0.029325513	0.117302053
志保	2.165725047	3.225047081	3.813559322	0	0.117702448	0	0	0.02354049	1.95386064	0.047080979	0.541431262
歩	0.960845544	3.795339899	1.657458564	2.378092722	0.33629594	0	0.384338218	0.192169109	4.155656978	0.072063416	1.3692049
ひなた	0.736478711	3.751438435	3.452243959	0.115074799	0.207134638	0	0.115074799	0.069044879	3.682393556	0.736478711	0.82853855
可奈	1.104176668	3.072491599	0.864138262	1.440230437	0.264042247	0	1.680268843	1.752280365	3.50456073	0	1.224195871
奈緒	1.505570611	3.131586871	1.62601626	1.776573321	0.511894008	0	0.240891298	0.391448359	2.890695574	0.120445649	1.324902138
千鶴	1.731133351	3.164728158	2.704895862	0.811468759	0.135244793	0	0.18934271	0.054097917	1.812280227	0	1.000811469
このみ	1.516136019	3.270521984	1.970976825	1.212908815	0.389863548	0	0.498158978	0.043318172	3.747021876	0	1.104613385
環	0.507185123	4.057480981	0.90166244	2.986756833	0.591715976	0	0.309946464	0.366300366	6.001690617	0	1.155255001
風花	1.672706997	3.484806245	2.090883747	0.613325899	0.25090605	0.02787845	0.919988849	0.08363535	3.010872595	0.13939225	1.059381098
美也	0.376749193	3.175457481	3.121636168	0.053821313	0.349838536	0	0.565123789	3.928955867	2.395048439	0	1.426264801
のり子	1.338803714	3.735694235	1.90023753	1.705895055	0.345497733	0	0.2591233	0.172748866	4.534657741	0.107968042	1.101274023
瑞希	2.945817991	3.340347186	4.366123093	0.052603893	0.026301946	0	0	0.052603893	1.394003156	0	1.578116781
可憐	7.34476367	6.000926784	2.687673772	0.347544022	0.069508804	0	0.556070436	0	2.618164968	0.046339203	0.857275255
莉緒	1.38284251	3.329065301	2.099871959	0.99871959	0.537772087	0	0.742637644	0.076824584	3.866837388	0	1.254801536
昴	0.829684259	3.572251671	2.189444572	1.567181378	0.32265499	0	0.207421065	0.161327495	5.346854114	0.09218714	1.474994238
麗花	0.691443388	2.722558341	1.339671564	1.36127917	0.496974935	0	1.318063959	0.345721694	3.370786517	0.021607606	1.815038894
桃子	1.589242054	3.496332518	3.178484108	0.391198044	0.464547677	0	0.097799511	0	4.205378973	0.024449878	0.806845966
ジュリア	1.095290252	3.789704272	3.110624315	0.744797371	0.394304491	0	0.109529025	0	4.074479737	0.04381161	1.292442497
紬	2.905027933	3.173184358	3.039106145	0.290502793	0.51396648	0	0	0	1.519553073	0	0.826815643
歌織	1.538461538	3.17016317	2.540792541	0.559440559	0.186480187	0	0.815850816	0	2.494172494	0.023310023	0.862470863
`;
const lines = data.split('\n');
let words = [];
let style = {};//{'春香':{'…':1.22},}
for (let i = 0; i < lines.length; i++){
	const line = lines[i];
	const items = line.split('\t');
	if (items.length < 2) continue;//2は適当
	if (i == 0){//ヘッダ
		for (let j = 1; j < items.length; j++){
			words.push(items[j]);
		}
	} else {
		let style_values = {};
		for (let j = 1; j < items.length; j++){
			style_values[words[j-1]] = Number(items[j]);
		}
		style[items[0]] = style_values;
	}

}
console.log(style);

init();
	</script>


</body>
</html>